<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Lavender</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <!-- <script>
    document.addEventListener("DOMContentLoaded", function() {
      flatpickr(document.getElementById("checkin"), {
        dateFormat: "d-m-y"
      });
      flatpickr(document.getElementById("checkout"), {
        dateFormat: "d-m-y"
      });
    });
  </script> -->
      </head>
      <body>
       <nav class="navbar navbar-expand-lg bg-light mb-3 shadow-sm p-3 bg-body rounded fixed-top">
      <div class="container">
        <a class="navbar-brand" href="/">
            <img src="https://dynamic.brandcrowd.com/asset/logo/a2ea32a5-2049-44d3-813b-6e895d00a61f/logo-search-grid-1x?logoTemplateVersion=1&v=637662604811930000" alt="Logo" width="36" height="30" class="d-inline-block align-text-top">
            Lavender
          </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          </ul>
          <ul class="navbar-nav  mb-2 mb-lg-0">
            <li class="nav-item me-4">
              <a class="nav-link active" aria-current="page" href="#">Forum</a>
            </li>
            <li class="nav-item me-4">
              <a class="nav-link active" aria-current="page" href="#">FAQs</a>
            </li>
            <li class="nav-item me-4">
              <a class="nav-link active" aria-current="page" href="#">Blog</a>
            </li>
          </ul>
          <div id="log-in">
      
          </div>
        </div>
      </div>
    </nav>
<br><br>
    <div class="container mt-5">
        <div class="row justify-content-center" id="product">
            <div class="col-md-5">
                <div id="carouselExampleInterval" class="carousel slide" data-bs-ride="carousel">
<div class="carousel-inner">
<div class="carousel-item active" data-bs-interval="10000">
<img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
</div>
<div class="carousel-item" data-bs-interval="2000">
<img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
</div>
<div class="carousel-item">
<img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
</div>
</div>
<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
<span class="carousel-control-prev-icon" aria-hidden="true"></span>
<span class="visually-hidden">Previous</span>
</button>
<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="next">
<span class="carousel-control-next-icon" aria-hidden="true"></span>
<span class="visually-hidden">Next</span>
</button>
</div>
      </div>
            <div class="col-md-5">
            <form class="container mt-2">
              <h3 id="name"></h3>
              <h5 id="price"></h5>
                <div class="form-group">
                  <label for="checkin">Check-in Date:</label>
                  <input type="date"  class="form-control"  id="checkin" required />
                </div>
                <div class="form-group">
                  <label for="checkout">Check-out Date:</label>
                  <input type="date"  class="form-control" id="checkout"  required/>
                </div>
                <div class="form-group">
                  <label for="guests">Number of Guests:</label>
                  <select class="form-control" id="guests">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                  </select>
                </div>
              <div class="mt-2" id="total"></div>
                <button type="submit" class="btn btn-primary btn-block mt-3" id='rzp-button1'>
                  Reserve
                </button>
              </form>
            </div>
        </div>
      </div>
      <section class="container my-5">
        <h2 class="text-center mb-3">Amenities</h2>
        <div class="row justify-content-center">
          <div class="col-sm-6 col-md-4">
            <div class="card border-0 shadow mb-4">
              <div class="card-body text-center">
                <h5 class="card-title">Free Parking</h5>
          <p class="card-text">Enjoy convenient, complimentary parking on our property.</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4">
            <div class="card border-0 shadow mb-4">
              <div class="card-body text-center">
                <h5 class="card-title">Security Cameras on Property</h5>
                <p class="card-text">Feel safe and secure with our 24/7 surveillance cameras.</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4">
            <div class="card border-0 shadow mb-4">
              <div class="card-body text-center">
                <h5 class="card-title">Free Wi-Fi</h5>
                <p class="card-text">
                  Stay connected with free Wi-Fi throughout the property.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="container text-center">
        <div class="row justify-content-center">
          <div class="col-10">

      Welcome to our hotel! We offer comfortable and spacious accommodations for travelers of all types. Our rooms feature modern amenities such as flat-screen TVs, high-speed internet, and complimentary breakfast.

We also have on-site dining options, a fitness center, and a business center for our guests' convenience. Our hotel is located in the heart of the city, making it easy for you to explore all that the area has to offer. Whether you're here for business or pleasure, we're sure you'll enjoy your stay with us.

We look forward to welcoming you and providing you with a comfortable and enjoyable experience. Please don't hesitate to contact us if you have any questions or need assistance with your booking.

Thank you for considering our hotel for your next trip!
</div>
        </div>
</div>

      <div class="container mt-5">
        <footer class="py-3 my-4">
          <ul class="nav justify-content-center border-bottom pb-3 mb-3">
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
            <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
          </ul>
          <p class="text-center text-muted">© 2022 Company, Inc</p>
        </footer>
      </div>
  
    <!-- <script>
        var amount;
        const params = new URLSearchParams(location.search);
        const data = JSON.parse(decodeURIComponent(params.get("data")));
        fetch('/api/products/' + data.id, {
            method: 'GET'
        })
            .then((response) => response.json())
            .then((data) => {
                amount = data.price;
                var card =
                    ` <div class="col-md-5">
                        <div id="carouselExampleInterval" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="10000">
      <img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item" data-bs-interval="2000">
      <img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="https://a0.muscache.com/im/pictures/981c1d31-d055-4c0f-ac38-a0deda2d0780.jpg?im_w=1200" class="d-block w-100" alt="...">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
              </div>
              <div class="col-md-5">
                <h1 class="product-title">${data.name}</h1>
                <p class="product-description">${data.description}</p>
                <p class="product-price">Rs. ${data.price}</p>
                <button class="btn btn-primary" id="rzp-button1">Pay Now</button>
              </div>`;

                document.getElementById('product').innerHTML = card;
                amount = amount * 100;
                var settings = {
                    "url": "/create/orderId",
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        "amount": amount
                    }),
                };

                //creates new orderId everytime
                $.ajax(settings).done(function (response) {

                    orderId = response.orderId;
                    console.log(orderId);
                    // $("button").show();
                });
            }).then(()=>{    
  document.getElementById('rzp-button1').onclick = function(e){
console.log(amount);
     var options = {
        
      "key": "rzp_test_09tqEjGt9Zl7Ll", // Enter the Key ID generated from the Dashboard
      "amount": amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Acme Corp",
      "description": "Test Transaction",
      "image": "https://dynamic.brandcrowd.com/asset/logo/a2ea32a5-2049-44d3-813b-6e895d00a61f/logo-search-grid-1x?logoTemplateVersion=1&v=637662604811930000",
      "order_id": orderId, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
        console.log(response);
          alert(response.razorpay_payment_id);
          alert(response.razorpay_order_id);
          alert(response.razorpay_signature)
        var settings = {
        "url": "/api/payment/verify",
        "method": "POST",
        "timeout": 0,
        "headers": {
         "Content-Type": "application/json"
          },
    "data": JSON.stringify({response}),
  }
        $.ajax(settings).done(function (response) {
          alert(JSON.stringify({response}));
        })
      },
      "theme": {
          "color": "#3399cc"
      }
  };
  var rzp1 = new Razorpay(options);
  rzp1.on('payment.failed', function (response){
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
  });
      rzp1.open();
      e.preventDefault();
  }
});
    </script> -->
    <script>
      const token1 = localStorage.getItem('token');
console.log(token1);
let logsec = document.getElementById('log-in');
console.log(logsec);
if(token1){
  var card =` <button class="btn btn-success me-2" id="logout">Log Out</button>`
  logsec.innerHTML=card;
}else{
  var card =`<a href="/login"><button class="btn btn-outline-success me-2" type="submit">Log In</button></a> 
      <button class="btn btn-success me-2" type="submit"> Sign up</button> `
    logsec.innerHTML=card;
}
      var numberOfDays;
      var orderId;
      const currentDate = new Date().toISOString().split('T')[0];
      let today = new Date();
      let tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      let tomorrowString = tomorrow.toISOString().split("T")[0];

      if (!document.getElementById("checkin") || !document.getElementById("checkout")) {
        console.error("Check-in and check-out elements not found.");
      }
      const total = document.getElementById("total");
      const checkin = document.getElementById("checkin");
      checkin.min = currentDate;

      const checkout = document.getElementById("checkout");
      checkout.min = tomorrowString;
      const calculateDays = () => {
        const checkinValue = checkin.value;
        const checkoutValue = checkout.value;
        if (!checkinValue || !checkoutValue) {
          console.error("Check-in and check-out dates are required.");
          return;
        }
        const checkinDate = new Date(checkinValue);
        const checkoutDate = new Date(checkoutValue);
        if (isNaN(checkinDate.getTime()) || isNaN(checkoutDate.getTime())) {
          console.error("Invalid check-in or check-out date.");
          return;
        }
        if (checkoutDate <= checkinDate) {
          alert("Check-out date cannot be less than or equal to check-in date.");
          checkout.value = "";
          return;
        }
        console.error(checkinDate + " " + checkoutDate);
        const timeDiff = Math.abs(checkoutDate.getTime() - checkinDate.getTime());
       numberOfDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
        console.log(`Number of days: ${numberOfDays}`);
        var settings = {
                    "url": "/create/orderId",
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        "amount": amount1 * 100 * numberOfDays
                    }),
                };

                //creates new orderId everytime
                $.ajax(settings).done(function (response) {

                    orderId = response.orderId;
                   
                    // $("button").show();
                })

                total.innerHTML='<b>Total</b>: ₹'+formatAmount(amount1 * numberOfDays)+' for '+numberOfDays+' Nights';
      };

  
      checkout.addEventListener("change", calculateDays);

      var amount1;
        const params = new URLSearchParams(location.search);
        const data = JSON.parse(decodeURIComponent(params.get("data")));
        fetch('/api/products/' + data.id, {
            method: 'GET'
        })
            .then((response) => response.json())
            .then((data) => {
                amount1 = data.price;
                document.getElementById('name').innerText= data.name;
                document.getElementById('price').innerText= '₹'+data.price;
            }); 

  document.getElementById('rzp-button1').onclick = function(e){
    e.preventDefault();
       const checkinValue = checkin.value;
        const checkoutValue = checkout.value;
    if (!checkinValue || !checkoutValue) {
          alert("Check-in and check-out dates are required.");
          return;
        }
    
    let amount = amount1 * 100 * numberOfDays;
                  console.log(orderId);
     var options = {
        
      "key": "rzp_test_09tqEjGt9Zl7Ll", // Enter the Key ID generated from the Dashboard
      "amount": amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Acme Corp",
      "description": "Test Transaction",
      "image": "https://dynamic.brandcrowd.com/asset/logo/a2ea32a5-2049-44d3-813b-6e895d00a61f/logo-search-grid-1x?logoTemplateVersion=1&v=637662604811930000",
      "order_id": orderId, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
        console.log(response);
          alert(response.razorpay_payment_id);
          alert(response.razorpay_order_id);
          alert(response.razorpay_signature)
        var settings = {
        "url": "/api/payment/verify",
        "method": "POST",
        "timeout": 0,
        "headers": {
         "Content-Type": "application/json"
          },
    "data": JSON.stringify({response}),
  }
        $.ajax(settings).done(function (response) {
          alert(JSON.stringify({response}));
        })
      },
      "theme": {
          "color": "#3399cc"
      }
  };
  var rzp1 = new Razorpay(options);
  rzp1.on('payment.failed', function (response){
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
  });
      rzp1.open();
      e.preventDefault();
    }
    function formatAmount(amount) {
  return amount.toLocaleString('en-IN', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

let logout = document.getElementById("logout");
        logout.addEventListener("click",(e)=>{
          e.preventDefault();
          localStorage.removeItem("token");
          window.location.href = '/';
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
 
    </body>
</html>